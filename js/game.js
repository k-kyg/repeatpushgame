(()=>{"use strict";const e=class{constructor(e){this.score=e.score,this.count=e.count,this.gametype=e.gametype,this.options=e.options,this.date=new Date}toJSON(){return{score:this.score,count:this.count,gametype:this.gametype,options:this.options,date:this.date}}};var t;class n extends HTMLElement{constructor(){super()}}customElements.define("game-field",n,{extends:"div"});const d=new URL(location.href).searchParams,l=d.get("gametype"),o=null===(t=d.get("option"))||void 0===t?void 0:t.split(",");let a=document.getElementById("gamefield");const c=Array(4),i=e=>new Promise((t=>setTimeout(t,e)));let r;const s=async()=>{let e=5;if("fourkeys"===l){for(;;){let e="";try{if(e=String(await m(r=Symbol())),confirm(e))break;c.fill("")}catch(e){e&&alert(e),c.fill("")}}r=Symbol()}let t=u(o);const n=function*(e){const t=document.createElement("h1"),n=document.createElement("span"),d=document.createElement("span"),o=document.createElement("h1"),c=document.createElement("span"),i=document.createElement("span"),r=document.createElement("br"),s=document.createElement("h2");let m=e.time;n.textContent="TimeLimit: ",d.textContent=String(m),c.textContent="連打数: ",i.textContent="0",s.textContent=("click"===l?"画面をクリックし":"キーボードを連打し")+"てください",d.id="timer",i.id="counter",t.appendChild(n),t.appendChild(d),o.appendChild(c),o.appendChild(i),yield,null==a||a.appendChild(s),null==a||a.appendChild(r),null==a||a.appendChild(t),null==a||a.appendChild(o),"click"===l&&(null==a||a.classList.add("gametypeclick")),yield}(t);n.next();const d=document.createElement("h1");for(d.classList.add("countdown"),null==a||a.appendChild(d);e>0;)d.textContent=String(e),await i(1e3),--e;null==a||a.removeChild(d),n.next(),p(t)},m=e=>new Promise(((t,n)=>{const d=document.createElement("div");d.classList.add("selectfield");{let e=0;for(;e<4;){const t=document.createElement("h1");t.setAttribute("data-fieldnum",String(e)),d.appendChild(t),++e}}null==a||a.appendChild(d);let l=0,o=0;window.addEventListener("keydown",(i=>{var s,m,u,p,h;if(e===r){switch(console.log(`cursor: ${l}`),i.code){case"Enter":4!==(null===(s=d.textContent)||void 0===s?void 0:s.length)&&(null==a||a.removeChild(d),n("無効です。選び直してください。")),null==a||a.removeChild(d),t(`「${null===(m=d.textContent)||void 0===m?void 0:m.split("").join(", ")}」でよろしいですか？`);break;case"Space":break;case"ArrowLeft":l>0&&--l;break;case"ArrowRight":l<3&&++l;break;case"Backspace":d.querySelector(`h1[data-fieldnum="${l}"]`).textContent="",delete c[l],l>0&&--l;break;default:if(i.metaKey||i.altKey||i.shiftKey||i.ctrlKey)break;if(1!==i.key.length||(null===(u=d.textContent)||void 0===u?void 0:u.includes(i.key.toLowerCase())))break;d.querySelector(`h1[data-fieldnum="${l}"]`).textContent=i.key.toLowerCase(),c[l]=i.code,l<3&&!c[l+1]&&++l}console.log(`selected keys: ${c}`),console.log(Array(20).fill("-").join("")),null===(p=d.querySelector(`h1[data-fieldnum="${o}"]`))||void 0===p||p.setAttribute("style","border-color: var(--txtcolor)"),null===(h=d.querySelector(`h1[data-fieldnum="${l}"]`))||void 0===h||h.setAttribute("style","border-color: rgb(0, 191, 255)"),o=l}}))})),u=e=>{let t=10,n=360,d=Array();switch(l){case"arrows":n=360,d=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];break;case"dfjk":n=360,d=["KeyD","KeyF","KeyJ","KeyK"];break;case"space":n=900,d=["Space"];break;case"enter":n=900,d=["Enter"];break;case"allkey":n=180;break;case"fourkeys":n=360,d=c;break;case"click":n=870}(null==e?void 0:e.includes("2x"))&&(n*=2),(null==e?void 0:e.includes("4x"))&&(n*=4,t*=.4,t=Math.floor(t)),(null==e?void 0:e.includes("0.5x"))&&(n*=2,t*=.5),(null==e?void 0:e.includes("+5"))&&(t+=5);let o={time:t,score:n,acceptkeys:d};return console.log(o),o},p=async e=>{const t=document.getElementById("timer"),n=document.getElementById("counter");let d=e.time,c=0,r=0;for(console.log(`options: ${o}`),console.log("Game Start!"),"click"===l?null==a||a.addEventListener("click",(()=>{++r,n.textContent=String(r)})):"allkey"===l?window.addEventListener("keyup",(()=>{++r,n.textContent=String(r)}),!0):window.addEventListener("keyup",(t=>{e.acceptkeys.includes(t.code)&&(++r,n.textContent=String(r))}),!0);await i(1e3),--d,t.textContent=String(d),!(d<=0););let s=r;(null==o?void 0:o.includes("2x"))&&(s/=2),(null==o?void 0:o.includes("+5"))&&Math.round(s*=.4),c=s*e.score,c+=(s-s%100)/100*10;const m={count:r,score:parseInt(String(c)),gametype:l,options:o};null==a||a.remove(),C(e,m)},h=()=>{a=document.createElement("div"),a.id="gamefield",a.classList.add("field"),document.getElementsByTagName("body")[0].appendChild(a),s()},C=(t,n)=>{var d;const o=document.createElement("div"),a=document.getElementById("ismobile"),i=new e(n);console.log(i),o.id="gamefield",o.classList.add("field"),document.getElementsByTagName("body")[0].appendChild(o);const r=document.createElement("table"),s=document.createElement("tr"),m=document.createElement("th"),u=document.createElement("tr"),p=document.createElement("td"),C=document.createElement("td"),y=document.createElement("tr"),E=document.createElement("td"),v=document.createElement("td"),g=document.createElement("tr"),k=document.createElement("td"),f=document.createElement("td"),x=document.createElement("tr"),b=document.createElement("td"),w=document.createElement("td"),L=document.createElement("tr"),S=document.createElement("td"),A=document.createElement("td"),$=document.createElement("div"),K=document.createElement("div"),j=document.createElement("a"),B=document.createElement("div"),I=document.createElement("a");switch(j.setAttribute("href","javascript:void(0)"),I.setAttribute("href","javascript:void(0)"),K.appendChild(j),B.appendChild(I),$.appendChild(K),$.appendChild(B),$.classList.add("resultbuttons"),K.classList.add("button"),B.classList.add("button"),"false"===a.value?(K.classList.add("hover"),B.classList.add("hover")):"true"===a.value&&(K.classList.add("active"),B.classList.add("active")),K.addEventListener("click",(()=>{c.fill(""),o.remove(),h()})),B.addEventListener("click",(()=>location.href="index.html")),m.textContent="結果",p.textContent="ゲームタイプ",E.textContent="制限時間",k.textContent="スコア",b.textContent="打数",S.textContent="オプション",j.textContent="リスタート",I.textContent="トップへ戻る",l){case"arrows":C.textContent="上下左右キー";break;case"dfjk":C.textContent="dfjk";break;case"space":C.textContent="スペースキー";break;case"enter":C.textContent="エンターキー";break;case"allkey":C.textContent="全てのキー";break;case"fourkeys":C.textContent="お好きな4キー";break;case"click":C.textContent="マウスクリック"}v.textContent=String(t.time),f.textContent=String(n.score),w.textContent=String(n.count),A.textContent=String(null===(d=n.options)||void 0===d?void 0:d.join(", ").replace(/,\s$/,"")),r.id="resulttable",r.classList.add("table"),m.setAttribute("colspan","2"),s.appendChild(m),u.appendChild(p),u.appendChild(C),y.appendChild(E),y.appendChild(v),g.appendChild(k),g.appendChild(f),x.appendChild(b),x.appendChild(w),L.appendChild(S),L.appendChild(A),r.appendChild(s),r.appendChild(u),r.appendChild(y),r.appendChild(g),r.appendChild(x),r.appendChild(L),o.appendChild(r),o.appendChild($)};window.addEventListener("DOMContentLoaded",(()=>console.log(`gametype: ${l}`))),window.addEventListener("load",(()=>s()))})();